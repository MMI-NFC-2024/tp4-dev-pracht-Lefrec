---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <h1 class="text-2xl">R312 TP4 Penguins</h1>
  <select name="species" id="species">
    <option value="">All species</option>
    <option value="Adelie">Adelie</option>
    <option value="Chinstrap">Chinstrap</option>
    <option value="Gentoo">Gentoo</option>
  </select>
  <select name="island" id="island">
    <option value="">All islands</option>
    <option value="Biscoe">Biscoe</option>
    <option value="Dream">Dream</option>
    <option value="Torgersen">Torgersen</option>
  </select>
  <select name="sex" id="sex">
    <option value="">All sex</option>
    <option value="MALE">male</option>
    <option value="FEMALE">female</option>
  </select>
  <div id="myplot"></div>
</Layout>

<script>
  import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
  import penguins from "../assets/penguins.json";

  const selectSpecies = document.querySelector("#species");
  const selectIsland = document.querySelector("#island");
  const selectSex = document.querySelector("#sex");

  function renderPlot() {
    const species = selectSpecies.value;
    const island = selectIsland.value;
    const sex = selectSex.value;
    const div = document.querySelector("#myplot");
    div.innerHTML = "";

    const plot = Plot.plot({
      marks: [
        Plot.dot(penguins, {
          x: "culmen_length_mm",
          y: "culmen_depth_mm",
          stroke: "species",
          filter: (d) =>
            (species == "" || d.species == species) &&
            (island == "" || d.island == island) &&
            (sex == "" || d.sex == sex),
        }),
      ],
    });
    div.append(plot);
  }

  selectSpecies.addEventListener("change", renderPlot);
  selectIsland.addEventListener("change", renderPlot);
  selectSex.addEventListener("change", renderPlot);

  renderPlot();
</script>
