---
import Layout from "../layouts/Layout.astro";
---

<Layout>
  <div class="max-w-4xl mx-auto p-6">
    <h1 class="text-3xl font-bold mb-6 text-center text-gray-800">
      R312 TP4 Pizzas
    </h1>

    <div class="flex flex-wrap gap-4 justify-center mb-8">
      <select
        id="category"
        class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option value="">All categories</option>
        <option value="Classic">Classic</option>
        <option value="Specialty">Specialty</option>
        <option value="Vegetarian">Vegetarian</option>
      </select>

      <select
        id="size"
        class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option value="">All sizes</option>
        <option value="Small">Small</option>
        <option value="Medium">Medium</option>
        <option value="Large">Large</option>
        <option value="Extra Large">Extra Large</option>
      </select>

      <select
        id="price"
        class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
      >
        <option value="">All prices</option>
        <option value="low">Under $15</option>
        <option value="mid">$15â€“20</option>
        <option value="high">Over $20</option>
      </select>

      <a href="/" class="px-4 py-2 border border-gray-300 rounded-lg shadow-sm hover:outline-none hover:ring-2 hover:ring-blue-500">PENGUINS</a>
    </div>

    <div
      id="myplot"
      class="bg-white shadow-md rounded-lg p-4 border border-gray-200 flex justify-center"
    ></div>
  </div>
</Layout>

<script>
  import * as Plot from "https://cdn.jsdelivr.net/npm/@observablehq/plot@0.6/+esm";
  import * as d3 from "https://cdn.jsdelivr.net/npm/d3@7/+esm";
  import pizzas from "../assets/pizza.json";

  const selectCategory = document.querySelector("#category");
  const selectSize = document.querySelector("#size");
  const selectPrice = document.querySelector("#price");
  const div = document.querySelector("#myplot");

  function renderPlot() {
    const category = selectCategory.value;
    const size = selectSize.value;
    const price = selectPrice.value;

    div.innerHTML = "";

    const plot = Plot.plot({
      marginLeft: 50,
      marginBottom: 50,
      x: { label: "Day of Week", domain: ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"] },
      y: { label: "Total Orders", domain: [0, 600000] },
      marks: [
        Plot.barY(pizzas, {
          x: "day_of_week",
          y: "orders",
          fill: "name",
          filter: (d) =>
            (category === "" || d.category === category) &&
            (size === "" || d.name.includes(size)) &&
            (
              price === "" ||
              (price === "low" && d.price < 15) ||
              (price === "mid" && d.price >= 15 && d.price <= 20) ||
              (price === "high" && d.price > 20)
            ),
        }),
        Plot.ruleY([0]),
      ],
    });

    div.append(plot);
  }

  selectCategory.addEventListener("change", renderPlot);
  selectSize.addEventListener("change", renderPlot);
  selectPrice.addEventListener("change", renderPlot);

  renderPlot();
</script>
